-# -*- coding: utf-8 -*-
.yield
 =form_for :account, :url => {:controller => :account} do |form|
  %fieldset
   %legend= t(:your_secret_key)
   =text_field :account, :secret_key, :class => :text, :value => current_user.spell
   =submit_tag t(:generate), :class => "submit red button large"

 %fieldset
  %legend Desktop notification
  =submit_tag t(:desktop_notification_on), {:id => 'dn-button', :class => "submit red button large"}
  .set-notification-time
   %label= t(:notification_time_in_second)
   =text_field_tag '', '', {:class => :text, :id => 'notification-time', :placeholder => t(:second)}
   %input{:type => 'submit', :id => 'set-notification-time-button', :value => t(:set)}
 =raw(call_hook :account_setting_item)

= content_for :javascripts do
 = javascript_include_tag "jquery-desktopnotify"
 :javascript
  $(function() {
    if (window.webkitNotifications && window.webkitNotifications.checkPermission() == 0) {
      $('#dn-button').attr("disabled", "disabled");
      $('#dn-button').addClass("gray");
    } else {
      $('#dn-button').desktopNotifyAddPermission();
    }
  });
 :javascript
  $(function() {
    $('#notification-time').val($.LocalStorage.getOrElse('notificationTime', 3));
    $('#set-notification-time-button').bind('click', function(e){
      var time = parseInt($('#notification-time').val());
      if (!isNaN(time)) {
        $.LocalStorage.set('notificationTime', time);
      }
    });
  });
